区块刻：
```python
获取所有“实体运算(强加载)”的区块为ChunkList列表
把ChunkList列表打乱顺序
此维度的区块刻阶段(tickChunks)： 

    # 1. 自然生成的维度上限和势能统计 (naturalSpawnCount)
    统计所有玩家附近方形距离8的区块数量(不重复)(玩家周围17x17的区块)(自然生成区块"naturalSpawnChunk")
    更新生成状态：
        获取大于等于“边界加载”的所有生物，
        对于 Mob类 and 非Misc类 and 没有“永久存在标记(普通永久存在标记 or 自定义永久存在标记)”：
            加入对应生物种类(MobCatgory)的维度上限(MobCap) # 单人的维度上限
            更新生成势能

    获取“待生成的生物种类列表”：
        MobCategory里面除了Misc的所有类
        "creature"仅在gametime整除400时加入列表(因为isPersistent判定)
        如果"/gamerule doMobSpawning" == false，那么列表就直接为空
    
    # 2. 每个区块先雷暴再刷怪 (spawnAndTick) 
    遍历所有的ChunkList列表，执行tickSpawningChunk：
        
        # 2.1 打雷(thunder) 
        如果：此区块为实体运算加载(强加载) and 维度天气为雷暴 and (1/10^5)的概率：
            # 寻找雷击目标 (总结：避雷针 > 实体 > 雷击初始落点)
            区块内随机选一个最高处“阻挡运动的方块”的上方的方块（并称之为A）：# 在这个位置寻找雷击目标
                如果：在A的“球形距离<=128”范围内存在避雷针：
                那么：直接返回避雷针的坐标
                否则如果：
                    形状B：包含A方块到世界最高方块的1xHx1形状(类似信标光柱)，再向六个方向膨胀3，得到最终的7x(3+H+3)x7大小的形状
                    在形状B内找LivingEntity(Mob、玩家、盔甲架)，满足：活的 and 实体可见天空(天空光照为15)
                    如果：能找到符合要求的实体
                    那么：随机选一个满足要求的实体，返回实体的位置
                    否则：（也就是避雷针和实体都没有）返回最开始的位置A
            # 闪电与骷髅马
            如果：雷击目标不是避雷针 and (区块难度 * 1%)的概率：
                生成骷髅陷阱马
            生成闪电，对齐到方块底部中心
            (如果生成了骷髅陷阱马则没有特效)

        # 2.2 spawner 自然生成生物
        执行此区块的生物生成 spawnForChunk：
            遍历要生成的“待生成的生物种类列表”：# 每个区块
                如果附近存在此生物种类上限不满的玩家(localMobCapCalculator.canSpawn)：
                执行此区块此生物种类的生成SpawnCategoryForChunk： # 每个生物种类
                    区块内随机选一个水平位置，在维度最低y ~ 最高非空气方块y值 +1 中选一个整数y位置 # “最高非空气方块的高度”在以前被社区俗称的LC值（然而这全都是个误解）
                    如果位置不为维度最低y，那么就在这个选中位置的方块执行生成，作为生成原点O: # 最高方块越低越好
                    # 生成生物主代码：
                        如果这个生成原点O的方块不是红石导体：# 非常重要，刷怪平面内不能有“可导方块”
                            j = 三组游走的总的生成数量计数器
                            三组成群生成：
                                游走起点重新设置为生成原点O
                                o = 随机1~4 # 仅作为初始默认数值，后面会根据选中的生物修改此数值
                                p = 0 # 热带鱼相关的计数器                           
                                每组成群生成(o次)：
                                    x,z 随机偏移(随机数(0~5) - 随机数(0~5)) 得到当前生成的位置
                                    # 每次游走的偏移量实际是个“三角分布”，范围为-5~5
                                    # 详细权重：0(6) ±1(5) ±2(4) ±3(3) ±4(2) ±5(1)
                                    如果(1)：
                                        当前位置距离玩家>24.0 and 距离出生点>=24.0 #  距离玩家(和出生点) > 24
                                        and (当前位置还在生成原点的区块 or 当前位置强加载) # 要求强加载
                                    那么：
                                        如果还未决定生成生物，则在当前位置随机选取可生成的生物 # 一般列表只与群系有关，但是“结构(structure)”会直接覆盖群系的列表
                                        如果选取出来的为空，直接停止这组成群生成
                                        spawnData为选取到的生成生物的信息
                                        o = 随机取该生物生成次数(最少次数~最大次数) # 多数为4~4或1~4
                                        如果(2)：
                                            生成类型不是 misc(杂项)
                                            and 满足生成势能判断
                                            and (距离玩家 <= 生物的立即消失距离 or 能远离玩家生成(canSpawnFarFromPlayer)) # 距离玩家 < 128(水生环境为64)
                                            and 此生物依然在新位置的可生成列表中 # canSpawnMobAt
                                            and 通过此生物的SpawnPlacements.Types 检查 # on_ground, in_water, in_lava, no_restrictions
                                            and 通过此生物的SpawnPlacements.checkSpawnRules 的检查 # check____SpawnRules
                                            and 生物碰撞箱不会被**方块**的碰撞箱阻塞(不考虑液体) # 方块碰撞检测
                                        那么：
                                            在缓存中生成此生物，偏航角随机(随机旋转)，俯仰角0度(平视)
                                            如果(3)：
                                                (距离玩家 <= 生物的立即消失距离 or 不会远离玩家消失(removeWhenFarAway))
                                                and Mob.checkSpawnRules # 各种下方方块判定，和是否大于或小于12亮度的判断(主世界闭区间，下界开区间)
                                                and 生物碰撞箱不在液体中 
                                                and 生物碰撞箱不会被**其他实体**的碰撞箱阻塞 # 实体碰撞检测
                                            那么：
                                                调用该生物的 finalizeSpawn 完善生成 # 设置手持物品，幼年化，骑士化等等
                                                j++, p++
                                                更新乘客状态相关
                                                
                                                afterSpawn：
                                                    更新生成势能
                                                    更新此种生物的“维度上限数量”
                                                    更新周围玩家(距离<128)关于此种生物的“本地生物”
                                                如果 j >= MaxSpawnClusterSize ，终止本区块这种生物类型的成群生成
                                                如果 p 达到了相关的数量限制(热带鱼独享)，只终止这组游走

    # 3. 所有区块的随机刻(tickTickingChunks) 
    遍历所有的ChunkList列表，对每个执行tickChunk：

            # 3.1 冰与雪("iceandsnow")：
                尝试randomTickSpeed次：
                    区块平面内选个位置
                    获取此位置最高的“阻挡运动(blockMotion)”的方块为Block，上方的方块为Block.above：
                    
                    如果Block：群系可结冰 and 是水源 and 四周存在“不含水的方块”(凝结核)
                    那么：结冰并发出更新

                    如果Block.above：正在下雨 and 是空气或雪片 and 雪片可以存活 and 方块亮度<10
                    那么：生成雪片(规则允许的话就积雪冰并抬高生物)

                    如果：Block的降水类型不为none (也就是rain或snow)
                    那么：处理Block的降水行为 (目前只有炼药锅)
            
            # 3.2 方块随机刻("tickBlocks")：
                对于这个区块的每个子区块，从低到高依次遍历：
                    如果这个子区块的存在“可以随机刻的方块或液体”的：
                        尝试randomTickSpeed次：
                            随机在这个子区块内选一个方块
                            对此方块尝试执行随机刻 (randomTick)

    # 4. 自定义生成 CustomSpawners：
        遍历所有自定义生成
            游商、幻翼、猫、袭击小队......
```

生物消失：实体运算阶段生物在运算前会先“检查消失” (checkDespawn)
```python
    
    Mob类实体的实现方法：
        
        如果：难度为和平模式 and 生物满足“和平模式消失”
        那么：消失
        
        否则如果：满足“永久存在”或“自定义永久存在” 
        那么：不消失，而且把noActionTime设置为0 # 永久存在 > 过远消失等
        否则：
            获取生物与最近的玩家的距离d

            如果 d > 消失距离 # 一般为128，桶装鱼等水生环境为64
            那么：消失
            
            否则如果：d > 不消失距离=32 and noActionTime >= 600(30s) and 生物“过远消失(d)” and 1/800 的概率
            那么：消失
            
            否则如果：d < 不消失距离=32
            那么：不消失，而且把noActionTime设置为0

    其它：
    潜影贝的子弹：和平模式会消失
    末影龙：不会消失
    凋灵：和平模式会消失，非和平模式不消失但是noActionTime设置为0
```

生物特性：
```python
1.  和平消失 (this.shouldDespawnInPeaceful)：
        怪物类(Monster)：true
        恶魂，幻翼，史莱姆(size>0)：true
        
        猪灵：false
        其它：false

2. 永久存在 (persistenceRequired) # 相关的方法：isPersistenceRequired, setPersistenceRequired
	这是Mob类生物的实体数据，默认为false
	以下情况会被改为true，并且不会再变回false了：
			当生物(Mob)捡起掉落物（捡起后穿上盔甲或手持物品，但并不包括生成时自带的）
            (命名牌)命名的的生物
			驯服相关：繁殖的悦灵、美西螈、疣猪兽
			转化：村民转化成的女巫和僵尸村民、猪被雷劈后的僵尸猪灵、蝌蚪方块生成的蝌蚪、蝌蚪长成的青蛙
            特殊生成：试炼刷怪笼生成的生物、闪电生成的陷阱马和陷阱骷髅、村庄生成的猫
			结构生物（来自于世界生成）：海底废墟(溺尸)、女巫小屋(女巫和猫)、林地府邸
            是远古守卫者

3.  自定义永久存在 (requiresCustomPersistence) # 基本为乘客判断
    Mob类：是乘客
        美西螈：是乘客 or 来自桶里
        末影人：是乘客 or 手持方块
        袭击相关生物：是乘客 or 正在袭击

4.  过远消失 (removeWhenFarAway(d))
	Mob类默认为true，以下为特例：
        此类不会过远消失(返回fasle)：
                动物(Animal)、傀儡类、悦灵
        此类满足条件就会过远消失(返回true)：
                桶装鱼和美西螈：不是来自桶里 and 没有命名
                鸡：是鸡骑士 # 即使小僵尸没了，“是鸡骑士“的标签依然永久存在，也无法下蛋，但是可以繁殖出正常的鸡
                猫和豹猫：未被驯服 and this.tickCount > 2400 # 豹猫和猫其实分裂来自不同的代码实现的，但是实际概念上都差不多是“被驯服”
                僵尸村民：不是正在转化中(治愈) and this.villagerXp == 0 # 有过交易村民转化成的僵尸村民不会消失，正在治愈的僵尸村民也不会消失
                疣猪兽、猪灵、坚守者：没有“永久存在”标签
        正在参加袭击的生物、灾厄巡逻队不会消失
            袭击生物：不在袭击中 and (不是巡逻小队 or 距离最近玩家 > 128)
5.  可以过远生成 (canSpawnFarFromPlayer)
	true：动物类("creature")，杂项类("misc")，掠夺者(pillager)，潜影贝(shulker)
	false：其余所有

7. 无动作时间 (noActionTime)
	在 Mob 的 checkDespawn 里面，当 noActionTime > 600 时，才有机会执行随机消失的代码
    
    以下情况下会归零：
        受伤(不免疫伤害)：livingEntity, 玩家(player)

		Mob类距离最近玩家距离小于32
		Mob类满足“永久存在”或“自定义永久存在”
		凋零：不在和平模式
		在拉弩：猪灵、掠夺者(pillager)
		袭击生物正在参与袭击

	Mob类每次tick的ai运算时候noActionTime增加1
		在此基础上，怪物类("monster")每次tick实际亮度过低时(主世界 <= 12, 下界 < 12)，noActionTime增加2

```