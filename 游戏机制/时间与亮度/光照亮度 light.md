
# Minecraft 光照 light

## 一、亮度定义

### 1. 天空亮度(skyLight) 和 方块亮度(blockLight)
| 类型         | 传播方式                     | 特性描述                     |
|--------------|----------------------------|----------------------------|
| **BlockLight** | 曼哈顿距离传播              | 由火把、熔炉等方块光源产生       |
| **SkyLight**   | 垂直向下等值传播 + 水平曼哈顿传播 | 实际上描述的是“天空可见度”，不受时间与天气影响 |

### 2. 天空暗度(skyDarken)计算
白天(约10min)：晴天=0，雨天=3，雷暴=5

夜间(约7min)：任何天气=11

昼夜交替(约1.5min)：近似线性变化

具体细节：net.minecraft.world.level.Level#updateSkyBrightness

也可以这个文档目录里的“timeOfDay_and_skyBrightness.py”画的图和详细的表格

## 二、关键亮度计算

### 1. 原始亮度(rawBrightness)

    rawBrightness(i) = max(skyLight - i, blockLight, 0)

    一般情况下i=0，实际计算的就是天空亮度(skyLight)和方块亮度(blockLight)的较大值

    唯一i不为零的情况，就是用于计算下面接着要说的实际亮度(maxLocalRawBrightness)

### 2. 实际亮度(maxLocalRawBrightness)

    世界之内：maxLocalRawBrightness() = rawBrightness(skyDarken)

    世界之外：maxLocalRawBrightness() = 15

### 3. 参考亮度(maxLocalRawBrightness(i))

    世界之内：maxLocalRawBrightness() = rawBrightness(i)

    世界之外：maxLocalRawBrightness() = 15

### 3. 亮度幻数(LightLevelDependentMagicValue)

某个坐标的亮度幻数，是靠此处的“实际亮度”和“维度环境光(下界为0.1，其余为0)”算出的

实际亮度从0到15，亮度幻数：主世界从0到1，下界从0.1到1，先缓后急的上升趋势(类似二次函数正增长)

作用：
1. 计算生物的寻路代价等
2. 能否在此处自然生成此生物(涉及到的全都是和0.5做比较)
    实际亮度为11，亮度幻数：主世界和末地≈0.4，下界≈0.44
    实际亮度为12，亮度幻数：主世界和末地=0.5，下界=0.55
    实际亮度为13，亮度幻数：主世界和末地≈0.6，下界≈0.66

详情：net.minecraft.world.level.LevelReader#getLightLevelDependentMagicValue

## 三、光照传播机制

影响亮度传播的因素：

	方块透明度：
		方块透明度共有三种：0，1，15
		15 = 完全透明
			玻璃、染色玻璃、屏障、铜网，以及很多不完整方块等
		
        1 = 仅散射天空光
			“完全透明”类方块含水后变为“仅散射天空光”
			不含水也能散射天空光的方块：
				岩浆；
				粘液块、蜜块，树叶，冰和霜冰，细雪，蜘蛛网，潜影盒，信标；
				紫颂花、紫颂植物，刷怪笼、试炼刷怪笼、宝库；

		0 = 完全遮光
			各种完整方块等，遮光玻璃
	
	方块阻挡传播(与遮挡形状有关)：
		1. 完全阻挡(各种方向都阻挡，透明度为0)：各种完整方块
		2. 完全透明(各种方向都透光，透明度为15或1)：基本都是不完整方块
		3. 部分阻挡(部分方向遮光，部分方向挡光，透明度为15或1)
			五面透光，底面遮光：
				不完整雪片、土径和耕地、
				阳光传感器、切石机、附魔台、讲台、末地门框架
				两种幽匿传感器、幽匿感测体
			四周透光，顶或底面遮光：
				半砖
			复杂形状：
				楼梯
		
        组合遮光：
			上面的方块是否阻挡光的传播只是经验情况，实际上光能否从一个面传播到另一个面
			取决于两个方块交界面来自两个方块贡献的“光照遮挡形状”能否构成完整面
			两个方块交界面如果遮挡形状能拼成完整面，也能遮光
			例如上半砖和下半砖挨在一起的交界面就无法通过光
			有些方块只是看起来有光照遮挡形状，但实际上没有，例如漏斗、细雪、头颅
			再就是组合遮光时，只有传播经过的两方块交界面的遮挡形状有用，方块内的光照遮挡形状无用