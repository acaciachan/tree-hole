# 区块刻
```python
获取所有“实体运算(强加载)”的区块为ChunkList列表
把ChunkList列表打乱顺序
此维度的区块刻阶段(tickChunks)： 

    # 1. 自然生成的状态初始化 (naturalSpawnCount)
    i = getNaturalSpawnChunkCount() # 获取自然生成区块数量，玩家的周围17x17，不重复
    获取新的spawnState = createState(i, ... , ...)：
        在当前维度区块(>=边界加载)中获取所有实体，依次遍历执行：
        对于 非Misc类 and 没有“永久存在标记(普通永久存在标记 or 自定义永久存在标记)”：
           
            如果当前生物与其所处群系有生成势能：
                生物势能列表.add{生物的方块位置,生物的势能} # 对应列表"spawnPotential"
            
            如果 当前实体为 Mob类：# 更新 "localMobCapCalculator"里的信息，如下：
                遍历所有活的玩家：
                    如果：此玩家到此实体所在区块中心的水平直线距离<128：
                        给"playerNearChunk"中的此区块添加此玩家
                        给"playerMobCounts"中此玩家的此生物类别计数+1
            给"mobCategoryCounts"添加此生物类别的计数+1
        "spawnableChunkCount" = i

    获取“待生成的生物类别列表”：
        MobCategory里面除了Misc的所有类
        "creature"仅在gametime整除400时加入列表(因为isPersistent判定)
        如果"/gamerule doMobSpawning" == false，那么列表就直接为空
    
    # 2. 每个区块先雷暴再刷怪 (spawnAndTick) 
    遍历所有的ChunkList列表，执行tickSpawningChunk：
        
        # 2.1 打雷(thunder) 
        如果：此区块为实体运算加载(强加载) and 维度天气为雷暴 and (1/10^5)的概率：
            # 寻找雷击目标 (总结：避雷针 > 实体 > 雷击初始落点)
            区块内随机选一个最高处“阻挡运动的方块”的上方的方块（并称之为A）：# 在这个位置寻找雷击目标
                如果：在A的“球形距离<=128”范围内存在避雷针：
                那么：直接返回避雷针的坐标
                否则如果：
                    形状B：包含A方块到世界最高方块的1xHx1形状(类似信标光柱)，再向六个方向膨胀3，得到最终的7x(3+H+3)x7大小的形状
                    在形状B内找LivingEntity(Mob、玩家、盔甲架)，满足：活的 and 实体可见天空(天空光照为15)
                    如果：能找到符合要求的实体
                    那么：随机选一个满足要求的实体，返回实体的位置
                    否则：（也就是避雷针和实体都没有）返回最开始的位置A
            # 闪电与骷髅马
            如果：雷击目标不是避雷针 and (区块难度 * 1%)的概率：
                生成骷髅陷阱马
            生成闪电，对齐到方块底部中心
            (如果生成了骷髅陷阱马则没有特效)

        # 2.2 spawner 自然生成生物
        执行此区块的生物生成 spawnForChunk：# 每个区块
            遍历要生成的“待生成的生物类别列表”：# 每个生物类别
                如果：localMobCapCalculator.canSpawn：# 当前区块附近存在此生物类别上限不满的玩家
                    查询"localMobCapCalculator"里的"playerNearChunk"，返回此区块附近的玩家列表
                    遍历此玩家列表，对于每个玩家去"playerMobCounts"查询个人生物容量统计
                        如果：此玩家生物容量统计中此生物类别上限不满(单人生物容量 < 此生物类别上限)
                        那么：返回true(canSpawn方法)
                    遍历完了所有玩家也没有不满的，那么返回fasle(canSpawn方法)
                那么：执行此区块此生物类别的生成SpawnCategoryForChunk # 此区块此生物类别的生成
                    区块内随机选一个水平位置，在维度最低y ~ 最高非空气方块y值 +1 中选一个整数y位置 # “最高非空气方块的高度”在以前被社区俗称的LC值（然而这全都是个误解）
                    如果位置不为维度最低y，那么就在这个选中位置的方块执行生成，作为生成原点O: # 最高方块越低越好
                    # 生成生物主代码：
                        如果这个生成原点O的方块不是红石导体：# 非常重要，刷怪平面内不能有“可导方块”
                            j = 0 # 三组游走的总的生成数量计数器
                            三组成群生成：
                                游走起点重新设置为生成原点O
                                o = 随机1~4 # 仅作为初始默认数值，后面会根据选中的生物修改此数值
                                p = 0 # 热带鱼相关的计数器                           
                                每组成群生成(o次)：
                                    x,z 随机偏移(随机数(0~5) - 随机数(0~5)) 得到当前生成的位置
                                    # 每次游走的偏移量实际是个“三角分布”，范围为-5~5
                                    # 详细权重：0(6) ±1(5) ±2(4) ±3(3) ±4(2) ±5(1)
                                    如果(1.isRightDistanceToPlayerAndSpawnPoint)：
                                        当前位置距离玩家>24.0 and 距离出生点>=24.0 #  距离玩家(和出生点) > 24
                                        and (当前位置还在生成原点的区块 or 当前位置强加载) # 要求强加载
                                    那么：
                                        如果spawnerData == 空，那么执行getRandomSpawnMobAt获取生物并赋值 # 考虑水生生物在某些群系降频，调用mobsAt
                                        如果依然有spawnerData == null，那么终止“当前这组成群生成”，继续下一组成群生成
                                        o = spawnerData这种生物的生成随机次数(最少次数~最大次数) # 多数为4~4或1~4
                                        
                                        如果(2.isValidSpawnPostitionForType)：
                                            生成类型不是 misc(杂项)
                                            and 满足生成势能判断
                                            and (距离玩家 <= 生物的立即消失距离 or 能远离玩家生成(canSpawnFarFromPlayer)) # 距离玩家 < 128(水生环境为64)
                                            and 此生物依然在此位置的可生成列表中(canSpawnMobAt) # 调用mobsAt
                                            and 通过此生物的SpawnPlacements.Types 检查 # on_ground, in_water, in_lava, no_restrictions
                                            and 通过此生物的SpawnPlacements.checkSpawnRules 的检查 # check____SpawnRules
                                            and 生物碰撞箱不会被**方块**的碰撞箱阻塞(不考虑液体) # 方块碰撞检测
                                        那么：
                                            新建spawnerData此生物，称之为 M
                                            如果 M == null，则直接终止“此区块此种生物类别”的生成 # 同时日志里面警告
                                            (在缓存中)把 M 移动到当前游走到的位置，设置看向随机的水平方向

                                            如果(3.isValidPositionForMob)：# 疑似mojang需要先弄出生物移动到位，才能进行实体碰撞检测
                                                (距离玩家 <= 生物的立即消失距离 or 不会远离玩家消失(removeWhenFarAway))
                                                and Mob.checkSpawnRules # 各种下方方块判定，和是否大于或小于12亮度的判断
                                                and 生物碰撞箱不在液体中 
                                                and 生物碰撞箱不会被**其他实体**的碰撞箱阻塞 # 实体碰撞检测
                                            那么：
                                                调用 M 的 finalizeSpawn 完善生成 # 设置手持物品，幼年化，添加骑士等等
                                                j++, p++
                                                将在刚刚缓存里的生成的生物实际添加到世界(serverLevel.addFreshEntityWithPassengers(M))
                                                更新乘客状态相关
                                                
                                                afterSpawn：
                                                    如果当前生物与其所处群系有生成势能：
                                                        生物势能列表.add{生物的方块位置,生物的势能} # 就是"spawnPotential"列表
                                                    
                                                    查询"localMobCapCalculator"里的"playerNearChunk"，返回此区块附近的玩家列表
                                                    对于此玩家列表中的每个玩家，给"playerMobCounts"中此玩家的此生物类别计数+1
                                                    
                                                    给"mobCategoryCounts"添加此生物类别的计数+1

                                                
                                                如果 j >= MaxSpawnClusterSize ，那么终止“此区块此种生物类别”生成
                                                如果 isMaxGroupSizeReached(p)，那么终止“当前这组成群生成”，继续下一组成群生成

    # 3. 所有区块的随机刻(tickTickingChunks) 
    遍历所有的ChunkList列表，对每个执行tickChunk：

            # 3.1 冰与雪("iceandsnow")：
                尝试randomTickSpeed次：
                    区块平面内选个位置
                    获取此位置最高的“阻挡运动(blockMotion)”的方块为Block，上方的方块为Block.above：
                    
                    如果Block：群系可结冰 and 是水源 and 四周存在“不含水的方块”(凝结核)
                    那么：结冰并发出更新

                    如果Block.above：正在下雨 and 是空气或雪片 and 雪片可以存活 and 方块亮度<10
                    那么：生成雪片(规则允许的话就积雪冰并抬高生物)

                    如果：Block的降水类型不为none (也就是rain或snow)
                    那么：处理Block的降水行为 (目前只有炼药锅)
            
            # 3.2 方块随机刻("tickBlocks")：
                对于这个区块的每个子区块，从低到高依次遍历：
                    如果这个子区块的存在“可以随机刻的方块或液体”的：
                        尝试randomTickSpeed次：
                            随机在这个子区块内选一个方块
                            对此方块尝试执行随机刻 (randomTick)

    # 4. 自定义生成 CustomSpawners：
        遍历所有自定义生成
            游商、幻翼、猫、袭击小队......
```

# 1. 生物类别(MobCategory)
Mojang划分的生物类别(MobCategory)在net.minecraft.world.entity.MobCategory，整理成表格:

|Name						|名字					|上限(max)|持久(isPersistent)|消失距离(despawnDistance)|友好(isFriendly)|
|:-							|:-						|:-		|:-				    |:-					|:-				|
|monster					|怪物					|70		|false			    |128				|**false**		|
|creature					|动物					|10		|**true**		    |128				|true			|
|ambient					|环境(蝙蝠)				|15		|false			    |128				|true			|
|water_ambient				|水生环境(桶装鱼)		|20		|false			    |**64**				|true			|
|water_creature				|水生生物(鱿鱼、海豚)	|5		|false			    |128				|true			|
|underground_water_creature	|地下水生生物(发光鱿鱼)	|5		|false              |128				|true			|
|axolotls					|美西螈					|5		|false			    |128				|true			|
|misc						|杂项					|-1		|true			    |128				|true			|

1. 其中杂项(misc)类似于Others，不参与自然生成
2. 友好(isFriendly)表示是否为友好生物。目前只有动物(creature)是true
3. 持久(isPersistent)表示是否为持久存在不消失的生物。目前只有动物(creature)和杂项(misc)是true
4. 立即消失距离(despawnDistance)表示距离最近玩家超过这个距离就会**立即消失**
5. 不消失距离(noDespawnDistance)表示距离最近玩家超过这个距离就**可以随机消失**，有玩家在这个范围内则不会
6. 上限(max)表示单玩家附近最大的生物数量
7. 具体某种实体属于哪一类，去这里查看：net.minecraft.world.entity.EntityType


# 2. 生物容量

SpawnState 刷怪的各种维度和个人的生物容量和势能相关的都包含于此

只列出4个需要关注的，其余的用于F3显示和缓存优化的就略掉了

```json
{
    "spawnableChunkCount": 36,    // 1. 可生成生物的区块数量(每个玩家周围17x17，不重复计数)

    "mobCategoryCounts": {    // 2. 此维度的生物容量统计
        "MONSTER": 42,
        "CREATURE": 28,
        "AMBIENT": 12,
        "AXOLOTLS": 3,
        "UNDERGROUND_WATER_CREATURE": 2,
        "WATER_CREATURE": 4,
        "WATER_AMBIENT": 8,
        "MISC": 5
    },

    "spawnPotential": {        // 3. 维度生成势能列表
    "charges": [                              
            {
                "pos": blockPos1,      // 某个生物的方块坐标
                "charge": 0.7          // 此生物的势能(charge)
            },
            {
                "pos": blockPos2,
                "charge": 1.0
            },
            {
                "pos": blockPos3,
                "charge": 0.7
            }
        ]
    },

    "localMobCapCalculator": {                      // 4. 个人生物容量
        
        "playersNearChunk": {                         // 4.1 每个区块中心附近直线距离小于128的玩家列表
            "chunkPos1": ["Player1", "Player2"],        // 区块坐标 → 玩家列表
            "chunkPos2": ["Player1"],
        },
        
        "playerMobCounts": {                        // 4.2 每个玩家周围生物数量统计
            "Player1": {                              // 玩家 → 生物数量统计
                "MONSTER": 15,                          // 被统计生物所在的区块的中心到玩家水平直线距离小于128
                "CREATURE": 8,                          
                "AMBIENT": 3,                           
            },
            "Player2": {
                "MONSTER": 12,                            // 该玩家附近只有12个怪物，没有别的生物类别
            }
        }
    }
}
```


# 3. 生物检查消失(checkDespawn)：

实体运算阶段生物在运算前会先“检查消失” 

```python
    Mob类实体的实现方法：
        
        如果：难度为和平模式 and 生物满足“和平模式消失”
        那么：消失
        
        否则如果：满足“永久存在”或“自定义永久存在” 
        那么：不消失，而且把noActionTime设置为0 # 永久存在 > 过远消失等
        否则：
            获取生物与最近的玩家的距离d

            如果 d > 消失距离 # 一般为128，桶装鱼等水生环境为64
            那么：消失
            
            否则如果：d > 不消失距离=32 and noActionTime >= 600(30s) and 生物“过远消失(d)” and 1/800 的概率
            那么：消失
            
            否则如果：d < 不消失距离=32
            那么：不消失，而且把noActionTime设置为0

    其它实体的实现方法：
    潜影贝的子弹：和平模式会消失
    末影龙：不会消失
    凋灵：和平模式会消失，非和平模式不消失但是noActionTime设置为0
```


# 4. 生物特性

## 4.1 和平消失 (this.shouldDespawnInPeaceful)
```python
        怪物类(Monster)：true
        恶魂，幻翼，史莱姆(size>0)：true
        
        猪灵：false
        其它：false
```

## 4.2 永久存在 (persistenceRequired)
```python
# 相关的方法：isPersistenceRequired, setPersistenceRequired
这是Mob类生物的实体数据，默认为false
以下情况会被改为true，并且不会再变回false了：
        当生物(Mob)捡起掉落物（捡起后穿上盔甲或手持物品，但并不包括生成时自带的）
        (命名牌)命名的的生物
        驯服相关：繁殖的悦灵、美西螈、疣猪兽
        转化：村民转化成的女巫和僵尸村民、猪被雷劈后的僵尸猪灵、蝌蚪方块生成的蝌蚪、蝌蚪长成的青蛙
        特殊生成：试炼刷怪笼生成的生物、闪电生成的陷阱马和陷阱骷髅、村庄生成的猫
        结构生物（来自于世界生成）：海底废墟(溺尸)、女巫小屋(女巫和猫)、林地府邸
        是远古守卫者
```
## 4.3  自定义永久存在 (requiresCustomPersistence)
```python
    Mob类：是乘客
        美西螈：是乘客 or 来自桶里
        末影人：是乘客 or 手持方块
        袭击相关生物：是乘客 or 正在袭击
```

## 4.4 过远消失 (removeWhenFarAway(d))
```python
	Mob类默认为true，以下为特例：
        此类不会过远消失(返回fasle)：
                动物(Animal)、傀儡类、悦灵
        此类满足条件就会过远消失(返回true)：
                桶装鱼和美西螈：不是来自桶里 and 没有命名
                鸡：是鸡骑士 # 即使小僵尸没了，“是鸡骑士“的标签依然永久存在，也无法下蛋，但是可以繁殖出正常的鸡
                猫和豹猫：未被驯服 and this.tickCount > 2400 # 豹猫和猫其实分裂来自不同的代码实现的，但是实际概念上都差不多是“被驯服”
                僵尸村民：不是正在转化中(治愈) and this.villagerXp == 0 # 有过交易村民转化成的僵尸村民不会消失，正在治愈的僵尸村民也不会消失
                疣猪兽、猪灵、坚守者：没有“永久存在”标签
        正在参加袭击的生物、灾厄巡逻队不会消失
            袭击生物：不在袭击中 and (不是巡逻小队 or 距离最近玩家 > 128)
```

## 4.5 可以过远生成 (canSpawnFarFromPlayer)
```python
	true：动物类("creature")，杂项类("misc")，掠夺者(pillager)，潜影贝(shulker)
	false：其余所有
```

## 4.6 无动作时间 (noActionTime)

在 Mob 的 checkDespawn 里面，当 noActionTime > 600 时，才有机会执行随机消失的代码
```python
    以下情况下会归零：
        受伤(不免疫伤害)：livingEntity, 玩家(player)

		Mob类距离最近玩家距离小于32
		Mob类满足“永久存在”或“自定义永久存在”
		凋零：不在和平模式
		在拉弩：猪灵、掠夺者(pillager)
		袭击生物正在参与袭击

	Mob类每次tick的ai运算时候noActionTime增加1
		在此基础上，怪物类("monster")每次tick实际亮度过低时(主世界 <= 12, 下界 < 12)，noActionTime增加2
```


# 5. 生成过程中的判断

# 5.1 获取可生成的生物相关
```python
    mobsAt: # 获取当前位置可生成的实体列表
        如果：当前结构为下界堡垒 and 下方方块是地狱砖(Blocks.NETHER_BRICKS)：
        那么：下界堡垒特“内结构”的生物列表
        否则：执行getMobsAt获取生物列表：
            如果：此位置存在结构(structure)
                and 当前生物类别(MobCategory)在结构的"spawn_overrides"中
                and 当前位置的“子结构”为当前生物类别(MobCategory)定义的"bounding_box"
            那么：返回此结构"spawn_overrides"中的当前生物类别(MobCategory)的"spawns"
            # 建议去看一眼海底神殿和下界堡垒的json文件的构造，就一目了然了
            否则：返回这个生物群系json文件的"spawners"

    getRandomSpawnMobAt：获取当前位置可生成的实体列表，并且随机一个实体
        如果：MobCategory为WATER_AMBIENT (桶装鱼)
            and 当前位置群系含有BiomeTags.REDUCED_WATER_AMBIENT_SPAWNS (river, frozen_river)
            and 98%概率
        那么：返回 空 # 水生环境类在河流和冻河里有98%概率失败
        否则：调用mobsAt方法获取可生成的实体列表，然后随机选一个
    

    canSpawnMobAt：判断在当前实体在当前位置是否存在于mobsAt方法返回的列表中
    
    # 下界堡垒的怪物要求在内结构("bounding_box": "piece")，
    # 所以mobsAt里面有“地狱砖 and 下界堡垒无论内外结构”也返回内结构列表的特判
```

## 5.2 生成势能相关
```python
某种生物和当前群系的组合，在群系json文件里可能存在的生成势能和生成预算，这种情况下就会进行势能相关的判断
    
    生成势能 mobSpawnCost.charge
    生成预算 mobSpawnCost.energyBudget
        灵魂沙峡谷(势能=0.7, 预算=0.15)：末影人、恶魂、骷髅、炽足兽
        诡异丛林(势能=1.0, 预算=0.12)：末影人
    
    计算某目标生物在某个位置P的势能，以及能否生成：
        E = 目标生物的charge * ∑(维度势能列表所有生物， 每个生物的charge / 到P的距离)
        如果目标生物的energyBudget >= E，那么返回true，否则返回false

```


## 5.3 能否生成生物

### 5.3.1 isValidSpawnPostitionForType

```python
返回true的条件：
        生成类型不是 misc(杂项)
    and 满足生成势能判断
    and (距离玩家 <= 生物的立即消失距离 or 能远离玩家生成(canSpawnFarFromPlayer)) # 距离玩家 < 128(水生环境为64)
    and 此生物依然在新位置的可生成列表中 # canSpawnMobAt
    and 通过此生物的SpawnPlacements.Types 检查 # on_ground, in_water, in_lava, no_restrictions
    and 通过此生物的SpawnPlacements.checkSpawnRules 的检查 # check____SpawnRules
    and 生物碰撞箱不会被**方块**的碰撞箱阻塞(不考虑液体) # 方块碰撞检测
```

### 5.3.2 isValidPositionForMob
```python
返回true的条件是:
    (距离玩家<=立即消失距离 or 不会远离玩家消失(removeWhenFarAway))
    and 允许自然生成 
    and 生物碰撞箱不在液体中 
    and 生物碰撞箱没有被**实体**的碰撞箱阻塞
```

### 5.3.3 Mob.checkSpawnRules
```python
    # 此方法在多数情况下和当前位置“实际亮度(与方块亮度、天空亮度、天空暗度等)”有关，
    # 而经过混乱的关系最终和“光照幻数(getLightLevelDependentMagicValue)”有关，在此总结一下实际效果
    生物(Mob)：true
        寻路类生物(PathFinderMob)：true
            动物：下方是草方块 or 实际光照 >= 12
                蘑菇牛：下方是菌丝 or 实际光照 >= 12
                海龟：下方含水 or 下方是沙子 or 实际光照 >= 12
                炽足兽：当前位置是岩浆 or 身体未接触到岩浆
                美西螈、蜜蜂：true
            怪物：实际亮度够暗(主世界和末地 <= 12, 下界 < 12)
                守卫者：下方含水 or 实际亮度够暗(主世界和末地 <= 12, 下界 < 12)
                蠹虫：下方是可寄生方块 or 实际亮度够暗(主世界和末地 <= 12, 下界 < 12)
                掠夺者、嘎吱怪、监守者、疣猪兽：true
```

### 5.3.4 SpawnPlacements.checkSpawnRules
在： net.minecraft.world.entity.SpawnPlacements#checkSpawnRules  
这里面根据生物类别和生成类型，调用不同的check____SpawnRules方法  
```python
通用的几种：
    1. checkMobSpawnRules # 通用生物
        由刷怪笼生成 or isValidSpawn(下方方块)
    
    2. checkAnyLightMonsterSpawnRules # 无视亮度的怪物
        难度不是和平 and checkMobSpawnRules
    
    3. checkMonsterSpawnRules # 通用怪物
        难度不是和平 and checkMobSpawnRules 
        and (生成来自试炼刷怪笼 or isDarkEnoughToSpawn)
        
        其中 isDarkEnoughToSpawn： # 生成位置足够暗
            skyLight <= (0~31)的随机整数 # 天空光越暗越好，为零时一定成功
            and 方块亮度 < (下界=15，其余=0)
            and “自定义实际亮度” < (下界=7, 其余=随机(0~7)) # 逆天mojang到处整随机数

            自定义实际亮度： # 逆天自定义亮度
                如果：此维度"has_skylight" == true 
                    and 此维度"has_ceiling" == fasle 
                    and rainLevel*thunderLevel > 0.9 # 可以认为是主世界的雷暴天气时
                那么：返回 max(blockLight, skyLight - 10)
                否则：返回 max(blockLight, skyLight - skyDarken)
            
            # "monster_spawn_block_light_limit"：下界=15，其余=0
            # "monster_spawn_light_level"：下界=7, 其余=随机(0~7)
    
    4. checkAnimalSpawnRules (动物通用生成)
        下方方块(BlockTags.ANIMALS_SPAWNABLE_ON)(只有草方块)
        and (来自试炼刷怪笼 or isBrightEnoughToSpawn)
        
        其中 isBrightEnoughToSpawn： # 生成位置足够亮
            max(skyLight, blockLight) >= 9 # 原始亮度>=9
```
### 5.3.5 SpawnPlacementTypes 生成放置类型：

四种放置类型：no_restrictions(无限制)、in_water(水中)、in_lava(岩浆中)、on_ground(在地面)
```python
1.	NO_RESTRICTIONS (无限制)：# 飞行类、还有一个特例狐狸
        无条件可以 
2.	IN_WATER (水中)：
        世界边界之内 and 此方块含水 and 上方不是红石导体 
3.	IN_LAVA (岩浆中) # 只有炽足兽
        世界边界之内 and 此方块含岩浆 
4.	ON_GROUND (在地面)：
        世界边境之内
        and isValidSpawn(下方方块)
        and isValidEmptySpawnBlock(此方块)
        and isValidEmptySpawnBlock(上方方块)

    isValidSpawn：# 生物能否在这个方块上方生成
        通用判定：方块上表面支撑形状完整 and 方块发光亮度 < 14
        特判：
            never (总是不能)：
                无法破坏方块：基岩、屏障、
                玻璃类：玻璃、染色玻璃、铜网、
                装饰类：活板门、紫颂花、脚手架(1.19.3+)
            always (总是能)：
                两个上表面碰撞箱不完整的：灵魂沙、泥巴、
                三个类光源方块：雕刻南瓜、南瓜灯、红石灯
            岩浆块：免疫火系伤害生物(.fireImmune)
            树叶：豹猫和鹦鹉
            冰、霜冰：北极熊
    
    isValidEmptySpawnBlock：# 生物能否在这个方块里面生成
        碰撞箱不能为完整方块 # isCollisionShapeFullBlock)
        and 不能是“红石信号源” # .isSignalSource)
        and 不能“含有液体” # fluidState.isEmpty())
        and 不是含有BlockTags.PREVENT_MOB_SPAWNING_INSIDE # 目前只有四种铁轨
        and 不是对于这个生物危险的方块(entityType.isBlockDangerous) # 详细分析看下方
    
        其中 isBlockDangerous：
            如果不是以下危险方块，什么生物都返回false(即不危险)
            如果是某个危险方块，但是此生物免疫这种危险方块就返回false(即不危险)，否则不免疫就返回true(危险)。
                
            危险方块和对应免疫的生物：
            1.  燃烧的方块(火、岩浆、岩浆块、点燃的营火、岩浆锅)：# (.fireImmune)
                下界生物：烈焰人、恶魂、岩浆怪、炽足兽、凋灵骷髅、僵尸疣猪兽、僵尸猪灵、凋零
                特殊生物：恼鬼、坚守者、末影龙、潜影贝
                其他实体：药水效果云、末影水晶、TNT
            # 以下均为.immuneTo(Block)
            2.  甜浆果：狐狸 
            3.  细雪：雪傀儡、北极熊、流浪者
            4.  凋灵玫瑰：凋灵、凋灵骷髅
            5.  仙人掌：(无)
```

### 5.4 额外的生成数量限制
```python
.getMaxSpawnClusterSize() 
    这种生物类别(MobCategory)的最大生成簇大小，
    是此区块此种生物类别的三组游走的数量之和的限制，
    当到达上限就直接终止本区块此种生物类别(MobCategory)的生成了
    Mob类 = 4
        桶装鱼和蝌蚪 = 8
        马类 = 6
        恶魂 = 1
        掠夺者 = 1
        狼 = 8

.isMaxGroupSizeReached(p) // 目前只有热带鱼会触发这个限制
    mob = false
    热带鱼：有一套限制阻止同种类热带鱼生成超过一定数量
```